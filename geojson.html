<!DOCTYPE html>
<html lang="sv" xml:lang="sv" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Vilka kommuner har deklarerat klimatnödläge?</title>
	<meta charset="utf-8" />
	<meta name="description" content="Karta som visar vilka kommuner i Sverige som utlyst klimatnödläge. #parentsforfuture #fridaysforfuture #climateemergencydeclaration #klimatnödläge">
  	<meta name="keywords" content="klimatnödläge, klimataktivism, parents for future, fridays for future">
  	<meta name="author" content="https://github.com/bjarman">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />-->
	<script type="text/javascript" sr="//unpkg.com/popper.js"></script>
    <link rel="stylesheet" href="//unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="//unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
	<script type="text/javascript" src="//code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/js/bootstrap.bundle.min.js" integrity="sha384-VoPFvGr9GxhDT3n8vqqZ46twP5lgex+raTCfICQy73NLhN7ZqSfCtfSn4mLA2EFA" crossorigin="anonymous"></script>
	<script type="text/javascript">
			!function(e){e.fn.preloader=function(t){function r(){c=e(i.selector)}function n(){switch(i.type){case"document":default:setTimeout(function(){o()},i.delay)}}function o(){switch(i.removeType){case"fade":a();break;case"remove":default:u()}}function u(){return c.remove()}function a(){return c.fadeOut(i.fadeDuration,f())}function f(){return function(){c.remove()}}var i=e.extend({selector:"#preloader",type:"document",removeType:"fade",fadeDuration:750,delay:0},t),c=null;return r(),this.ready(function(){e(this).trigger("preloader:before"),n(),e(this).trigger("preloader:after")})}}(jQuery);

			/**
		 * jQuery serializeObject
		 * @copyright 2014, macek <paulmacek@gmail.com>
		 * @link https://github.com/macek/jquery-serialize-object
		 * @license BSD
		 * @version 2.5.0
		 */
		!function(e,i){if("function"==typeof define&&define.amd)define(["exports","jquery"],function(e,r){return i(e,r)});else if("undefined"!=typeof exports){var r=require("jquery");i(exports,r)}else i(e,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,i){function r(e,r){function n(e,i,r){return e[i]=r,e}function a(e,i){for(var r,a=e.match(t.key);void 0!==(r=a.pop());)if(t.push.test(r)){var u=s(e.replace(/\[\]$/,""));i=n([],u,i)}else t.fixed.test(r)?i=n([],r,i):t.named.test(r)&&(i=n({},r,i));return i}function s(e){return void 0===h[e]&&(h[e]=0),h[e]++}function u(e){switch(i('[name="'+e.name+'"]',r).attr("type")){case"checkbox":return"on"===e.value?!0:e.value;default:return e.value}}function f(i){if(!t.validate.test(i.name))return this;var r=a(i.name,u(i));return l=e.extend(!0,l,r),this}function d(i){if(!e.isArray(i))throw new Error("formSerializer.addPairs expects an Array");for(var r=0,t=i.length;t>r;r++)this.addPair(i[r]);return this}function o(){return l}function c(){return JSON.stringify(o())}var l={},h={};this.addPair=f,this.addPairs=d,this.serialize=o,this.serializeJSON=c}var t={validate:/^[a-z_][a-z0-9_]*(?:\[(?:\d*|[a-z0-9_]+)\])*$/i,key:/[a-z0-9_]+|(?=\[\])/gi,push:/^$/,fixed:/^\d+$/,named:/^[a-z0-9_]+$/i};return r.patterns=t,r.serializeObject=function(){return new r(i,this).addPairs(this.serializeArray()).serialize()},r.serializeJSON=function(){return new r(i,this).addPairs(this.serializeArray()).serializeJSON()},"undefined"!=typeof i.fn&&(i.fn.serializeObject=r.serializeObject,i.fn.serializeJSON=r.serializeJSON),e.FormSerializer=r,r});
	</script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js"></script>
	<link type="text/css" rel="stylesheet" href="//stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
	<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" />
	<!--<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css" />-->
	<!--<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-classic.css" />-->
	<!--<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-minima.css" />-->
	<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-plain.css" />
	<link type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
	<script type="text/javascript" src="geojson.js" type="text/javascript"></script>
	<script>
		var entry;
		var entry_array = [];
		var municipal_array = [];
		var municipal_id;
		var municipal_code_array = [];
		var yellow_number = Number(0);
		var yellow_population = Number(0);
		var total_number = Number(0);
		var total_population = Number(0);

		$(document).ready(function() {
			$('window').preloader();

			function prepareEmail(municipal_id, mail_id, proposal){
				var contact = municipalContactLookup(municipal_id);
				//var formattedBody = encodeURIComponent($('#mailbody_' + mail_id).html());
				var mailToLink = contact["email"];
				var mailBody = "";

				if(mail_id == 1){
					mailBody += contact.name + " behöver utlysa klimatnödläge!\r\n";
					mailBody += "Vår gemensamma livsmiljö är hotad! Vi vädjar till folkvalda i " + contact["name"] + " att agera kraftfullt och utlysa nödläge för klimatet i vår kommun.\r\n";
					mailBody += "På flera ställen runt om i världen har man på det lokala planet utlyst nödläge för klimatet. I städer som Vancouver, Basel, och Oxford har man gått före och visat vägen. Nyligen utlyste även Storbritannien, som första land, klimatnödläge.\r\n";
					mailBody += "Efter att ha tagit del av kommunens handlingsplan med åtgärder för klimat och energiarbetet har vi insett att de åtgärder som hittills tagits i kommunen när det gäller att säkerställa en hållbar utveckling och Co2-neutral livsstil är vällovliga men tyvärr helt otillräckliga.\r\n";
					mailBody += "Vi har därför beslutat att vända oss till våra folkvalda politiker med en akut vädjan.\r\n";
					mailBody += "Vi anser att kommunen, för att möta den akuta klimatkrisen, måste mobilisera alla tänkbara resurser. Det kommer att krävas genomgripande förändringar och en aktiv agenda som i allt sätter vår gemensamma framtid i världen och i kommunen överst. Om vi ska ha minsta chans att lyckas med vår omställning måste alla politiska beslut tas mot bakgrund av den akuta klimatkrisen.\r\n\r\n";
					mailBody += "Vi anser att kommunens politiker nu behöver:\r\n";
					mailBody += "1. Erkänna att vi befinner oss i ett klimatnödläge.\r\n";
					mailBody += "2. Ge kommunen i uppdrag att skyndsamt ta fram en klimatnödlägesplan och prioritera planen i kommunens strategiska arbete.\r\n";
					mailBody += "3. Fastställa att kommunen i klimat-nödlägesplanen tar på sig att informera alla kommunens invånare om nödläget och samverka med lokala aktörer för en skyndsam omställning. Kommunen bör även löpande informera invånarna om vilka åtgärder som vidtagits.\r\n";
					mailBody += "4. Erkänna att nödläget varar tills världens nationer säkerställt att målet att den globala uppvärmningen inte passerar ödesdigra 1,5 grader, i enlighet med Parisavtalet.\r\n";
					mailBody += "5. Fastställa att kommunen enligt klimatnödlägesplanen prioriterar att samarbeta med andra kommuner internationellt och nationellt för att bygga upp kompetens och ta kompensatoriskt ansvar för en snabb omställning tills högre politiker tar sitt fulla ansvar för omställningen till en hållbar framtid. Om vi ska kunna se kommande generationer i ögonen är det dags att agera nu. Vi vill som aktiva och ansvarstagande medborgare stå bakom våra politiker i den omställning som kommer att krävas.\r\n";
				}
				
				if(mail_id == 2){
					mailBody += contact["name"] + " behöver utlysa klimatnödläge!\r\n";
					mailBody += "Jag är starkt oroade över att inte tillräckliga åtgärder vidtas för att bryta den snabba utvecklingen mot klimatkatastrof, utarmningen av jorden och utrotning av djur och växter. I Parisavtalet 2015 beslutade världens nationer att temperaturökningen bör begränsas till max 1,5 grader. Utifrån de åtgärder som hittills utlovats globalt tyder dock ingenting på att detta mål kommer att nås. Istället är vi på väg mot en katastrofal uppvärmning på mellan 3 och 5 grader.\r\n\r\n";
					mailBody += "Vår gemensamma livsmiljö är hotad!\r\n";
					mailBody += "Klimatkrisen måste börja behandlas som den kris den faktiskt är.\r\n";
					if(proposal) {
						mailBody += "Det finns ett initiativ i vår kommun för att utlysa klimatnödläge.\r\n";
						mailBody += "Initiativet hittar ni här: " + proposal + "\r\n";
						mailBody += "Jag stödjer initiativet fullt ut och vädjar till kommunens folkvalda att agera kraftfullt och utlysa nödläge för klimatet i vår kommun.";
					}
				}
				
				var mailContent = "Subject=Utlys klimatnödläge nu!&";
				mailContent += "body=" + encodeURIComponent(mailBody);
				mailContent = mailToLink + "?" + mailContent;
				return mailContent;
			}

			var jqxhr = $.getJSON("https://spreadsheets.google.com/feeds/list/1DMrOOb_QxBDZgPzgFrh9GQSx1XR8I1y0ZFaXpItT__w/1/public/full?alt=json", function(data) {
				entry = data.feed.entry;
				$(entry).each(function(){
					municipal_id = this.title.$t;
					var a = this.content.$t.split(",");
					entry_array = a.map(function(item){
					return item.split(": ").pop();
				});
				var ma = {
					"id": this.gsx$code.$t,
					"name": this.gsx$name.$t,
					"population": this.gsx$population.$t,
					"email": this.gsx$email.$t,
					"www": this.gsx$www.$t,
					"phone": this.gsx$phone.$t,
					"ced_status": this.gsx$cedstatus.$t,
					"discussion_status": this.gsx$discussionstatus.$t,
					"citizen_suggest_link": this.gsx$citizensuggestlink.$t,
					"citizen_proposal": this.gsx$citizenproposal.$t,
					"citizen_proposal_ref": this.gsx$citizenproposalref.$t

				};
				municipal_array.push(ma);
				});
			})
			.done(function() {
				init();
  			})
  			.fail(function() {
    			//console.log( "error" );
  			})
  			.always(function() {
    			//console.log( "always" );
  			});
			function ced_status(municipal_id){
				var mid;
				$(municipal_array).each(function(){
				if(this.id == municipal_id){
					mid = this.ced_status;
				}
			});
			return mid;
		}

		function discussion_status(municipal_id){
			var mid;
			$(municipal_array).each(function(){
				if(this.id == municipal_id){
					mid = this.discussion_status;
				}
			});
			return mid;
		}

		function municipalContactLookup(municipal_id){
			var mid;
			$(municipal_array).each(function(){
				if(this.id == municipal_id){
					that = this;
				}
			});
			return that;
		}

		var s = [];
		var map = L.map('map', {minZoom: 5, maxZoom: 8}).setView([63.020557650316576, 18.092765808105472], 5);
		var ol = [];
		
		
		
		function onEachFeature(feature, layer) {

			L.stamp(layer);
			feature.properties.ced = ced_status(feature.properties['ref:se:kommun:kod']);
			feature.properties.discussion_status = discussion_status(feature.properties['ref:se:kommun:kod']);
			var c = feature.properties.ced == 1 ? 'har' : 'har inte';
			var municipal_info = municipalContactLookup(feature.properties['ref:se:kommun:kod']);
			
			total_number++;
			total_population = total_population + parseInt(municipal_info.population.replace(/ /g, ''));
			
			var d = feature.properties.discussion_status == 1 ? 'pågår' : 'pågår inte';
			var popupContent = "<p style='color: red;'><strong>" + feature.properties['name'] + " " + c + " utlyst klimatnödläge!</strong></p>";
			var fillColor;
			if(municipal_info.ced_status == 1){
				//Grön kommun
				fillColor = {fillColor: '#1CA549'};
				popupContent += "<p style='color: #1CA549;'>JIPPI!</p>";
			}
			else if(municipal_info.ced_status == 2){
				//Röd kommun + skicka mail #2
				fillColor = {fillColor: '#FF3300'};
				popupContent += "<p style='color: red;'><strong>" + feature.properties['name'] + " har aktivt röstat NEJ till att utlysa klimatnödläge :(</strong></p>";
				popupContent += "<p>Sätt ytterligare press på kommunen genom att <a href='mailto:" + prepareEmail(feature.properties['ref:se:kommun:kod'], 2, municipal_info.citizen_proposal) + "'>skicka ett mail</a> där du meddelar att du stödjer kravet på att ytlysa klimatnödläge!</p>";
			}
			else if(municipal_info.ced_status == 0 && municipal_info.discussion_status == 0){
				//Grå kommun + skicka mail #1
				fillColor = {fillColor: '#F2F2F2'};
				popupContent += "<p>Just nu pågår ingen diskussion om att utlysa klimatnödläge :(</p>";
				if(municipal_info.citizen_suggest_link){
					popupContent += "<p>Som invånare kan du lämna ett förslag till kommunen <a target='_blank' href='" + municipal_info.citizen_suggest_link + "'>här.</a></p>";
				}
				popupContent += "Skicka <a href='mailto:" + prepareEmail(feature.properties['ref:se:kommun:kod'], 1) + "'>ett mail</a> till kommunen med krav på ytlysande av klimatnödläge!</p>";
				popupContent += '<button type="submit" class="ced-form-open btn btn-sm btn-success">Hjälp oss samla in data!</button>';
			}
			else if(municipal_info.ced_status == 0 && municipal_info.discussion_status == 1){
				//Gul kommun + mail #2
				yellow_number++;
				yellow_population = yellow_population + parseInt(municipal_info.population.replace(/ /g, ''));
				fillColor = {fillColor: '#FFCC00'};
				popupContent += "<p>Just nu pågår en diskussion om att utlysa klimatnödläge :)</p>";
				if(municipal_info.citizen_proposal){
					popupContent += "<p>Du kan läsa mer om processen och vad du som invånare kan göra <a target='_blank' href='" + municipal_info.citizen_proposal + "'>här.</a></p>";
				}
				popupContent += "<p>Sätt ytterligare press på kommunen genom att <a href='mailto:" + prepareEmail(feature.properties['ref:se:kommun:kod'], 2, municipal_info.citizen_proposal) + "'>skicka ett mail</a> där du meddelar att du stödjer kravet på att ytlysa klimatnödläge!</p>";
			}
			layer.setStyle(fillColor);

			if (feature.properties && feature.properties.popupContent) {
				popupContent += feature.properties.popupContent;
			}
			
			layer.bindPopup(popupContent);

			layer.on('popupopen', function(e){
				$('#municipal').val(e.target._leaflet_id); // Select the option with a value of '1'
				$('#municipal').trigger('change'); // Notify any JS components that the value changed
				$(".ced-form-open").click(function(){
					$("#ced-form-container").show();
				});
			});

			s.push({[feature.properties["ref:se:kommun:kod"]]:{
				layer: layer,
        		name: feature.properties.name,
				short_name: feature.properties.short_name,
				ced: feature.properties.ced,
				code: feature.properties["ref:se:kommun:kod"]
       		}});

			ol.push({
				municipal: feature.properties['name'],
				id: layer._leaflet_id
			});
			municipal_code_array.push({
				municipal: feature.properties['name'],
				code: feature.properties["ref:se:kommun:kod"]
			});
			
			legend.update(feature.properties['name'], layer._leaflet_id);
		}

		var legend = L.control({position: 'topright'});
	 	legend.onAdd = function (map, ol) {
	    	var div = L.DomUtil.create('div', 'info legend');
	    	var dropDownContent ='<select id="municipal" class="select2"><option>Välj kommun</option></select>';
	    	div.innerHTML = dropDownContent;
	    	div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
	    	return div;
		};

		legend.update = function(key, value){
			L.DomUtil.get(this._container.firstChild).add(
				new Option(key, value)
			);
		}

		legend.addTo(map);

		var legend2 = L.control({position: 'bottomright'});
	 	legend2.onAdd = function (map, ol) {
	    	var div = L.DomUtil.create('div', 'info legend mobile-hide');
	    	var shareContent ='<div id="shareRoundIcons"></div>';
	    	div.innerHTML = shareContent;
	    	div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
	    	return div;
		};

		legend2.addTo(map);
		
		var legend3 = L.control({position: 'topright'});
		legend3.onAdd = function(){
			var div = L.DomUtil.create('div', 'info legend colorcodes mobile-hide');
			//var divContent = "Vi har en påbörjad process i " + yellow_number + " kommuner med " + yellow_population + " invånare. " + (yellow_population/total_population*100).toFixed(2) + "% av befolkningen, " + (yellow_number/total_number*100).toFixed(2) + "% av kommunerna.";
			var divContent = "<i style='background: #F2F2F2;'></i> Ingen process<br /><i style='background: #FFCC00;'></i> Påbörjad process<br /><i style='background: #1CA549;'></i> Ja till klimatnödläge<br /><i style='background: #FF3300;'></i> Nej till klimatnödläge<br /><div id='stats'></div>";
			//divContent += '<div class="btn-group btn-group-sm btn-group-vertical" role="group" aria-label="Basic example"><button type="submit" class="ced-form-open btn btn-success"><i class="fa fa-cog"></i> Hjälp oss samla in data!</button><button type="button" class="btn btn-danger"><i class="fa fa-info-circle"></i> Vad är klimatnödläge?</button><button type="button" class="btn btn-info"><i class="fa fa-info-circle"></i> Mall</button></div>';
			div.innerHTML = divContent;
			div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
	    	return div;
		};
		
		legend3.addTo(map);
		
		var legend4 = L.control({position: 'topright'});
		legend4.onAdd = function(){
			var div = L.DomUtil.create('div', 'info legend mobile-hide');
			//var divContent = "Vi har en påbörjad process i " + yellow_number + " kommuner med " + yellow_population + " invånare. " + (yellow_population/total_population*100).toFixed(2) + "% av befolkningen, " + (yellow_number/total_number*100).toFixed(2) + "% av kommunerna.";
			//var divContent = "<i style='background: #F2F2F2;'></i> Ingen process<br /><i style='background: #FFCC00;'></i> Påbörjad process<br /><i style='background: #1CA549;'></i> Ja till klimatnödläge<br /><i style='background: #FF3300;'></i> Nej till klimatnödläge<br /><div id='stats'></div>";
			var divContent = '<div id="infobuttons" class="btn-group btn-group-sm btn-group-vertical" role="group" aria-label=""><button type="submit" class="ced-form-open btn btn-success text-left"><i class="fa fa-cog"></i> Datainsamling</button><button type="button" class="btn btn-danger text-left"><i class="fa fa-info-circle"></i> Klimatnödläge?</button><button type="button" class="btn btn-info text-left"><i class="fa fa-info-circle"></i> Mall</button></div>';
			div.innerHTML = divContent;
			div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
	    	return div;
		};
		
		legend4.addTo(map);
		
		
		L.control.scale().addTo(map);

		map.on('layeradd', function(e) {
    		//console.log(e);
    		// do something related to the layer that was added
		})

		map.on('moveend', function(e){
			//console.log(e);
		});

		map.on('popupopen', function(e){
			//console.log(e);
		});

		var myStyle = {
    		"color": "#666666",
    		"weight": 1,
    		"opacity": 1.0,
    		"fillOpacity": 1.0
		};

		function init(){
			L.geoJSON(gjson, {
				style: myStyle,
				filter: function (feature, layer) {
						if (feature.properties) {
							return feature.properties.underConstruction !== undefined ? !feature.properties.underConstruction : true;
						}
					return false;
				},
				onEachFeature: onEachFeature
			}).addTo(map);
			$('#municipal').select2();

			$('#municipal').on('select2:select', function (e) {
				var data = e.params.data;
				map._layers[data.id].openPopup();
				map.fitBounds(map._layers[data.id].getBounds());
			});

			municipal = document.getElementById("municipal");
			municipal.addEventListener("change", function(){
			map._layers[municipal.value].openPopup();
			map.fitBounds(map._layers[municipal.value].getBounds());

		});

		$("#shareRoundIcons").jsSocials({
    		showLabel: false,
    		showCount: false,
    		shares: ["email", "twitter", "facebook", "linkedin"]
		});
		
		$("#shareRoundIcons").append('<a target="_blank" href="https://github.com/bjarman/cedmap" style="color: black; font-size: 25px;"><i class="fa fa-github"></i></a><br />');
		$("#shareRoundIcons").append('<a target="blank_" href="http://www.cccoders.org" alt="Climate Change Coders"><img width="88px" height="31px" id="cccoders-logo" src=""/></a><br /><br />');

  		$("#cccoders-logo").attr("src", "data:image/svg+xml;base64," + window.btoa('<svg width="216px" height="76px" viewBox="0 0 216 76" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Group"><rect id="Rectangle" fill="#5700FF" x="0" y="0" width="216" height="76" rx="8"></rect><text id="01101000-01110100-01" fill-opacity="0.5" fill="#FFFFFF" font-family="Courier" font-size="10" font-weight="normal"><tspan x="2.98291016" y="11">01101000 01110100 01110100 01110000 </tspan><tspan x="2.98291016" y="23">00111010 00101111 00101111 01110111 </tspan><tspan x="2.98291016" y="35">01110111 01110111 00101110 01100011 </tspan><tspan x="2.98291016" y="47">01100011 01100011 01101111 01100100 </tspan><tspan x="2.98291016" y="59">01100101 01110010 01110011 00101110 </tspan><tspan x="29.9873047" y="71">01101111 01110010 01100111</tspan></text><text id="{cccoders.org}" fill="#FFFFFF" font-family="Courier" font-size="25" font-weight="normal"><tspan x="3.48291016" y="44">{cccoders.org}</tspan></text></g></g></svg>'));

		$("#shareRoundIcons").append('<a rel="license" target="_blank" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a></a><br /><br />');
		
		//$("#shareRoundIcons").append('<div class="btn-group btn-group-sm btn-group-vertical" role="group" aria-label="Basic example"><button type="submit" class="ced-form-open btn btn-success"><i class="fa fa-cog"></i> Hjälp oss samla in data!</button><button type="button" class="btn btn-danger"><i class="fa fa-info-circle"></i> Vad är klimatnödläge?</button><button type="button" class="btn btn-info"><i class="fa fa-info-circle"></i> Mall</button></div>');
		
		//$("#shareRoundIcons").append('<div class="dropdown" id=“infolinks”><button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Vad är klimatnödläge?</button><div class="dropdown-menu" aria-labelledby="dropdownMenuButton"><a class="dropdown-item" href="#">Om klimatnödläge</a><a class="dropdown-item" href="#">Mall</a></div></div>');
		
		$("#ccoders-logo").attr("src", $("#ccoders-logo-svg").html());
		//var $code_options = $("#municipal > option").clone();

		$.each(municipal_code_array, function(key, value) {
			$('#code')
				.append($('<option>', { value : value.code })
				.text(value.municipal));
			});
		$('#code').select2({
			width: '100%',
			dropdownParent: $("#ced-form")
		});
		$('#code').change(function(){
			$('#name').val($("#code option:selected").text());
		});
		$(".ced-form-open").click(function(){
			console.log("click");
			$("#ced-form-container").show();
		});
		$("#stats").html("Pågående processer i <strong>" + yellow_number + "</strong> kommuner med <strong>" + yellow_population + "</strong> invånare. <strong>" + (yellow_population/total_population*100).toFixed(2) + "%</strong> av befolkningen, <strong>" + (yellow_number/total_number*100).toFixed(2) + "%</strong> av kommunerna");
		$('window').preloader();
	}


	var $form = $('form#ced-form'),
	url = 'https://script.google.com/macros/s/AKfycby8dZdaPtf14KneWGuKDVynxGD8QlE0CqxnNrcTFUYDWoSgHWA/exec';
	$form.submit(function(e){
		e.preventDefault();
		$(".h").empty();
		if($("#code option:selected").val() == "Välj kommun"){
			$("#code_help").html("<p style='color: red;'>Du måste välja en kommun.</p>");
		}
		if (!$("input:radio[name='ced_status']").is(":checked")) {
   			$("#ced_status_help").html("<p style='color: red;'>Du måste välja ett alternativ.</p>");
		}
		else {
		var jqxhr = $.ajax({
			url: url,
			method: "GET",
			dataType: "json",
			//data: $(form).find("select, input, textarea").serializeJSON()
			data: $form.serializeObject()
		}).fail(function() {
			//console.log( "error" );
		}).done(function() {
			//console.log("Done?");
			//$(".thanks").html("Thank you for getting in touch!").css("font-size","4rem");
			$("#ced-form").remove();
			$("#ced-form-open").remove();
			$("#ced-form-container").html("<p>Tack för att du hälper till med datainsamlingen!</p>").fadeOut(5000, function(){
				$("#ced-form-container").hide();
			});
		});
		}
	});
	$("#abort").click(function(){
		$("#ced-form-container").hide();
	});
});
</script>
	<style>
		#map {
			width: 100%;
			height: 100%;
			background: transparent;
		}
		html, body {
			height: 100%;
      width: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			background-color: #FFFFFF;
			background-image: url('https://showyourstripes.info/stripes/EUROPE-Sweden--1901-2018-BK.png');
  		background-position: top;
  		background-repeat: repeat-y;
  		background-size: contain;
  		margin: 0;
  		padding: 0;
		}
		#shareRoundIcons{
			text-align: right;
		}
		.jssocials-share-link {
			border-radius: 50%;
			background-color: black;
			color: white !important;
			font-size: 8px;
		}

		#preloader {
		  position: fixed;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  z-index: 1000
		}

		#preloader #preloader-inner {
		  display: block;
		  position: relative;
		  left: 50%;
		  top: 50%;
		  width: 150px;
		  height: 150px;
		  margin: -75px 0 0 -75px;
		  border-radius: 50%;
		  border: 3px solid transparent;
		  border-top-color: #3498db;
		  animation: spin 2s linear infinite
		}

		#preloader #preloader-inner:before {
		  content: "";
		  position: absolute;
		  top: 5px;
		  left: 5px;
		  right: 5px;
		  bottom: 5px;
		  border-radius: 50%;
		  border: 3px solid transparent;
		  border-top-color: #e74c3c;
		  animation: spin 3s linear infinite
		}

		#preloader #preloader-inner:after {
		  content: "";
		  position: absolute;
		  top: 15px;
		  left: 15px;
		  right: 15px;
		  bottom: 15px;
		  border-radius: 50%;
		  border: 3px solid transparent;
		  border-top-color: #f9c922;
		  animation: spin 1.5s linear infinite
		}
		@keyframes
		spin { 0% {
		transform:rotate(0deg)
		}

		to { transform: rotate(1turn) }
		}
		#ced-form-container{
			position: absolute;
			z-index: 1111;
			padding: 20px;
			top: 20px;
			left: 10%;
			width: 80%;
			float: left;
			background: rgba(255, 255, 255, .8);
			display: none;
		}
		.colorcodes {

    padding: 6px 8px;
    font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,1);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
	text-align: left;
    line-height: 18px;
    color: #555;
    width: 168px;
		}
		.colorcodes i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 1;
}
#stats {
	text-align: left;
	border-top: 1px solid #F2F2F2;
	margin-top: 5px;
}
#infobuttons {
	width: 168px;
	text-align: left;
}
@media only screen and (max-width: 479px) {
   .mobile-hide{ display: none !important; }
}
	</style>
</head>
<body>
	<div id="preloader">
  		<div id="preloader-inner"></div>
	</div>
	<div id='map'></div>
	<div id="ced-form-container">
	<form id="ced-form">
	  <div class="form-group row">
	    <label for="code" class="col-4 col-form-label">Välj kommun</label>
	    <div class="col-8">
	      	<select name="code" id="code" data-select2-id="code" tabindex="-1" class="custom-select"><option>Välj kommun</option></select>
	      	<span id="code_help" class="form-text text-muted h"></span>
	      	<input type="hidden" name="name" id="name" value=""/>
	    </div>
	  </div>
	  <div class="form-group row">
	    <label class="col-4 col-form-label">Beslut om att utlysa klimatnödläge</label>
	    <div class="col-8">
	      <div class="custom-controls-stacked">
	        <div class="custom-control custom-checkbox">
	          <input name="ced_status" id="ced_status_0" type="radio" class="custom-control-input" value="0">
	          <label for="ced_status_0" class="custom-control-label">Beslut att utlysa klimatnödläge är inte fattat</label>
	        </div>
	      </div>
	      <div class="custom-controls-stacked">
	        <div class="custom-control custom-checkbox">
	          <input name="ced_status" id="ced_status_1" type="radio" class="custom-control-input" value="1">
	          <label for="ced_status_1" class="custom-control-label">Beslut att utlysa klimatnödläge är fattat</label>
	        </div>
	      </div>
	      <div class="custom-controls-stacked">
	        <div class="custom-control custom-checkbox">
	          <input name="ced_status" id="ced_status_2" type="radio" class="custom-control-input" value="2">
	          <label for="ced_status_2" class="custom-control-label">Beslut att inte utlysa klimatnödläge är fattat</label>
	        </div>
	      </div>
	      <span id="ced_status_help" class="form-text text-muted h"></span>
	    </div>
	  </div>
	  <div class="form-group row">
	    <label for="citizen_proposal" class="col-4 col-form-label">Klistra in länk till beslut/förslag om det finns</label>
	    <div class="col-8">
	      <div class="input-group">
	        <div class="input-group-prepend">
	          <div class="input-group-text">
	            <i class="fa fa-link"></i>
	          </div>
	        </div>
	        <input id="citizen_proposal" name="citizen_proposal" type="text" class="form-control">
	      </div>
	    </div>
	  </div>
	  <div class="form-group row">
	    <label class="col-4">Diskussion/process inför beslut</label>
	    <div class="col-8">
	      <div class="custom-control custom-checkbox custom-control-inline">
	        <input name="discussion_status" id="discussion_status_0" type="radio" class="custom-control-input" value="0">
	        <label for="discussion_status_0" class="custom-control-label">Ingen diskussion eller process är påbörjad</label>
	      </div>
	      <div class="custom-control custom-checkbox custom-control-inline">
	        <input name="discussion_status" id="discussion_status_1" type="radio" class="custom-control-input" value="1">
	        <label for="discussion_status_1" class="custom-control-label">Diskussion eller process är påbörjad</label>
	      </div>
	    </div>
	  </div>
	  <div class="form-group row">
	    <label for="citizen_proposal_ref" class="col-4 col-form-label">Klistra in länk till diskussion/process om det finns</label>
	    <div class="col-8">
	      <div class="input-group">
	        <div class="input-group-prepend">
	          <div class="input-group-text">
	            <i class="fa fa-link"></i>
	          </div>
	        </div>
	        <input id="citizen_proposal_ref" name="citizen_proposal_ref" type="text" class="form-control">
	      </div>
	    </div>
	  </div>
	  <div class="form-group row">
	    <label for="comment" class="col-4 col-form-label">Kommentar</label>
	    <div class="col-8">
	      <textarea id="comment" name="comment" cols="40" rows="5" class="form-control"></textarea>
	    </div>
	  </div>
	  <div class="form-group row">
	    <div class="offset-4 col-8">
	    	<button name="abort" type="button" class="btn btn-warning" id="abort">Avbryt</button>
	    	<button name="submit" type="submit" class="btn btn-primary">Skicka</button>
	    </div>
	  </div>
	</form>
	</div>
</body>
</html>